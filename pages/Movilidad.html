<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: Corporativa Verde y Dorado -->
    <!-- Application Structure Plan: Se utiliza un layout profesional con un menú lateral fijo para filtros y acciones, y un área de contenido principal. Esta arquitectura separa los controles de la visualización, mejorando la usabilidad y escalabilidad. En móvil, el menú se colapsa a una barra superior para optimizar el espacio. El flujo de información es jerárquico: KPIs generales, gráficos de tendencias y comparativos, y finalmente una tabla con datos granulares para exploración detallada. -->
    <!-- Visualization & Content Choices: Se eligieron KPIs en tarjetas para impacto inmediato. Un gráfico de líneas para mostrar la evolución anual (cambio en el tiempo). Un gráfico de barras horizontales para comparar el volumen entre trámites (comparación), con un toggle para cambiar de contexto (particular/público). Una tabla detallada con buscador para la exploración profunda de los datos. Se usa Chart.js (Canvas) para todos los gráficos. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title>Dashboard de Trámites Vehiculares</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-dark-green: #2E3B2B;
            --brand-green: #71785b;
            --brand-gold: #bc9b73;
            --brand-light-gray: #F3F4F6;
            --sidebar-width: 280px;
        }
        body {
            font-family: 'Roboto Condensed', sans-serif;
            background-color: var(--brand-light-gray);
            color: #374151;
        }
        h1, h2, h3, .kpi-value {
            font-family: 'Montserrat', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 12px -1px rgb(0 0 0 / 0.06), 0 2px 8px -2px rgb(0 0 0 / 0.04);
            border: 1px solid #E5E7EB;
        }
        .kpi-title {
            font-family: 'Roboto Condensed', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            color: #6B7280;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }
        .kpi-value {
            font-size: 2.25rem; 
            font-weight: 800;
            color: var(--brand-dark-green);
        }
        .section-title {
            font-size: 1.5rem; 
            font-weight: 700;
            color: var(--brand-dark-green);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        .section-title svg {
            color: var(--brand-gold);
        }
        .sidebar {
            width: var(--sidebar-width);
            background-color: #ffffff;
            border-right: 1px solid #E5E7EB;
        }
        .main-content {
            margin-left: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
        }
        .filter-group button.active {
            background-color: var(--brand-dark-green);
            color: white;
            font-weight: 700;
        }

        @media (max-width: 1024px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; width: 100%; }
            .mobile-header { display: flex; }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex">
        <!-- Sidebar -->
        <aside class="sidebar fixed top-0 left-0 h-screen p-6 flex-col space-y-8 no-print hidden lg:flex">
            <div class="flex items-center justify-center">
                <img src="https://cdn.prod.website-files.com/66d75f3897a0c14fc42017af/67d124efdfc13b41bfb24b65_Logo_Inicio.svg" alt="Logo" class="h-20" onerror="this.onerror=null; this.src='https://placehold.co/200x80/FFFFFF/2E3B2B?text=Logo';">
            </div>
            <div class="space-y-6">
                <h2 class="font-bold text-lg text-gray-700">Filtros</h2>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Año de Análisis</label>
                    <div id="year-filter" class="filter-group grid grid-cols-2 gap-2">
                        <button data-year="2021" class="p-2 border rounded-md transition">2021</button>
                        <button data-year="2022" class="p-2 border rounded-md transition">2022</button>
                        <button data-year="2023" class="p-2 border rounded-md transition">2023</button>
                        <button data-year="2024" class="p-2 border rounded-md transition active">2024</button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Servicio</label>
                    <div id="type-filter" class="filter-group grid grid-cols-1 gap-2">
                        <button data-type="Todos" class="p-2 border rounded-md transition active">Todos</button>
                        <button data-type="Particular" class="p-2 border rounded-md transition">Particular</button>
                        <button data-type="Público" class="p-2 border rounded-md transition">Público</button>
                    </div>
                </div>
                <div>
                    <label for="tramite-filter" class="block text-sm font-medium text-gray-700 mb-1">Trámite Específico</label>
                    <select id="tramite-filter" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-offset-1" style="--tw-ring-color: var(--brand-gold);"></select>
                </div>
            </div>
            <div class="pt-4 mt-auto">
                 <button id="print-button" class="w-full bg-gray-700 text-white font-bold py-2 px-4 rounded-md hover:bg-gray-800 transition-colors flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                    Imprimir Reporte
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content w-full p-4 sm:p-6 lg:p-8">
            <!-- Mobile Header -->
            <div class="mobile-header lg:hidden items-center justify-between bg-white p-4 rounded-lg shadow-sm mb-6 no-print">
                <img src="https://cdn.prod.website-files.com/66d75f3897a0c14fc42017af/67d124efdfc13b41bfb24b65_Logo_Inicio.svg" alt="Logo" class="h-12">
                <button id="print-button-mobile" class="bg-gray-700 text-white font-bold py-2 px-4 rounded-md">Imprimir</button>
            </div>
             <div class="lg:hidden bg-white p-4 rounded-lg shadow-sm mb-6 space-y-4 no-print">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Año</label>
                    <div id="year-filter-mobile" class="filter-group grid grid-cols-4 gap-2">
                        <button data-year="2021" class="p-2 border rounded-md transition text-sm">2021</button>
                        <button data-year="2022" class="p-2 border rounded-md transition text-sm">2022</button>
                        <button data-year="2023" class="p-2 border rounded-md transition text-sm">2023</button>
                        <button data-year="2024" class="p-2 border rounded-md transition text-sm active">2024</button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Servicio</label>
                    <div id="type-filter-mobile" class="filter-group grid grid-cols-3 gap-2">
                        <button data-type="Todos" class="p-2 border rounded-md transition text-sm active">Todos</button>
                        <button data-type="Particular" class="p-2 border rounded-md transition text-sm">Part.</button>
                        <button data-type="Público" class="p-2 border rounded-md transition text-sm">Púb.</button>
                    </div>
                </div>
                <div>
                    <label for="tramite-filter-mobile" class="block text-sm font-medium text-gray-700 mb-1">Trámite Específico</label>
                    <select id="tramite-filter-mobile" class="w-full p-2 border border-gray-300 rounded-md shadow-sm"></select>
                </div>
            </div>
            
            <header class="mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Dashboard de Trámites Vehiculares</h1>
                <p class="text-gray-500">Análisis de volumen de trámites particulares y públicos.</p>
            </header>

            <!-- Dashboard Content -->
            <div id="dashboard-content" class="space-y-8">
                <!-- KPIs -->
                <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6">
                    <div class="card"><h2 class="kpi-title">Total Trámites (Selección)</h2><p id="kpi-total" class="kpi-value">0</p></div>
                    <div class="card"><h2 class="kpi-title">Total Particulares (Año)</h2><p id="kpi-particulares" class="kpi-value">0</p></div>
                    <div class="card"><h2 class="kpi-title">Total Públicos (Año)</h2><p id="kpi-publicos" class="kpi-value">0</p></div>
                    <div class="card"><h2 class="kpi-title">Variación Anual (Selección)</h2><p id="kpi-variacion" class="kpi-value">0%</p></div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 xl:grid-cols-5 gap-6">
                    <div class="card xl:col-span-3">
                        <h2 id="evolucion-title" class="section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                            Evolución Anual de Trámites
                        </h2>
                        <div class="h-80"><canvas id="evolucionChart"></canvas></div>
                    </div>
                    <div id="top-tramites-card" class="card xl:col-span-2">
                         <div class="flex justify-between items-center mb-4">
                            <h2 id="top-tramites-title" class="section-title !mb-0">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                                Top 5 Trámites
                            </h2>
                        </div>
                        <div class="h-80"><canvas id="topTramitesChart"></canvas></div>
                    </div>
                </div>

                <!-- Data Table -->
                <section>
                    <h2 class="section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        Detalle de Trámites
                    </h2>
                    <div class="card">
                        <input type="text" id="search-input" placeholder="Buscar trámite..." class="w-full p-2 border border-gray-300 rounded-md mb-4">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Trámite</th>
                                        <th class="px-6 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">2021</th>
                                        <th class="px-6 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">2022</th>
                                        <th class="px-6 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">2023</th>
                                        <th class="px-6 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">2024</th>
                                    </tr>
                                </thead>
                                <tbody id="full-data-table" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        // Data
        const datosParticulares = [
            { tramite: "ALTA DE VEHICULO CON BAJA FORANEA", "2021": 8636, "2022": 8012, "2023": 5431, "2024": 7323 },
            { tramite: "ALTA DE VEHICULO CON BAJA FORANEA Y CAMBIO DE PROPIETARIO", "2021": 10748, "2022": 14881, "2023": 8735, "2024": 14026 },
            { tramite: "ALTA DE VEHICULO CON CAMBIO DE PROPIETARIO", "2021": 11065, "2022": 13878, "2023": 10669, "2024": 13689 },
            { tramite: "ALTA DE VEHICULO NUEVO", "2021": 70631, "2022": 75146, "2023": 93569, "2024": 136672 },
            { tramite: "ALTA DE VEHICULO SIN ANTECEDENTE DE REGISTRO", "2021": 3949, "2022": 6048, "2023": 3525, "2024": 19073 },
            { tramite: "ALTA DE VEHICULO USADO O FORANEO", "2021": 4093, "2022": 4179, "2023": 4009, "2024": 4588 },
            { tramite: "BAJA DEL PADRON ESTATAL", "2021": 24375, "2022": 28878, "2023": 30366, "2024": 35221 }
        ];
        const datosPublicos = [
            { tramite: "ALTA VEHICULO PUBLICO", "2021": 37, "2022": 104, "2023": 51, "2024": 80 },
            { tramite: "CAMBIO DE VEHICULO", "2021": 3220, "2022": 3086, "2023": 2409, "2024": 1953 },
            { tramite: "CESIÓN DE DERECHOS", "2021": 1287, "2022": 1115, "2023": 996, "2024": 675 },
            { tramite: "DEPOSITO DE PLACAS", "2021": 3522, "2022": 3492, "2023": 2805, "2024": 2218 },
            { tramite: "DUPLICADO DE TARJETA DE CIRCULACIÓN SERVICIO PUBLICO", "2021": 327, "2022": 442, "2023": 395, "2024": 229 },
            { tramite: "DUPLICADO DE TARJETON", "2021": 28, "2022": 53, "2023": 26, "2024": 20 },
            { tramite: "REFRENDO DE TARJETA DE CIRCULACIÓN", "2021": 14, "2022": 6, "2023": 8, "2024": 7 },
            { tramite: "REFRENDO DE TARJETÓN", "2021": 10708, "2022": 13331, "2023": 12072, "2024": 11316 },
            { tramite: "RENOVACIÓN DE TÍTULO", "2021": 1824, "2022": 1155, "2023": 402, "2024": 1841 }
        ];

        // State
        let selectedYear = '2024';
        let selectedType = 'Todos';
        let selectedTramite = 'Todos';
        let charts = {};

        // Helper function
        const sumTotal = (dataset, year) => dataset.reduce((sum, item) => sum + (item[year] || 0), 0);

        function getFilteredData() {
            let data;
            if (selectedType === 'Particular') {
                data = datosParticulares;
            } else if (selectedType === 'Público') {
                data = datosPublicos;
            } else {
                data = [...datosParticulares, ...datosPublicos];
            }

            if (selectedTramite !== 'Todos') {
                data = data.filter(item => item.tramite === selectedTramite);
            }
            return data;
        }

        // Update Functions
        function updateKPIs() {
            const year = selectedYear;
            const prevYear = String(Number(year) - 1);

            const currentData = getFilteredData();
            const totalCurrent = sumTotal(currentData, year);
            const totalPrev = sumTotal(currentData, prevYear);
            
            document.getElementById('kpi-total').textContent = totalCurrent.toLocaleString();
            document.getElementById('kpi-particulares').textContent = sumTotal(datosParticulares, year).toLocaleString();
            document.getElementById('kpi-publicos').textContent = sumTotal(datosPublicos, year).toLocaleString();

            const variacionEl = document.getElementById('kpi-variacion');
            if (totalPrev > 0) {
                const variacion = ((totalCurrent - totalPrev) / totalPrev) * 100;
                variacionEl.textContent = `${variacion.toFixed(1)}%`;
                variacionEl.style.color = variacion >= 0 ? '#16A34A' : '#DC2626';
            } else {
                variacionEl.textContent = 'N/A';
                variacionEl.style.color = '#6B7280';
            }
        }

        function updateEvolucionChart() {
            const years = ['2021', '2022', '2023', '2024'];
            const data = getFilteredData();
            
            let datasets = [];

            if (selectedTramite !== 'Todos') {
                 datasets.push({
                    label: selectedTramite,
                    data: years.map(year => sumTotal(data, year)),
                    borderColor: 'rgba(188, 155, 115, 1)',
                    backgroundColor: 'rgba(188, 155, 115, 0.1)',
                    fill: true,
                    tension: 0.3
                });
            } else {
                 if (selectedType === 'Particular' || selectedType === 'Todos') {
                    datasets.push({
                        label: 'Particulares',
                        data: years.map(year => sumTotal(datosParticulares, year)),
                        borderColor: 'rgba(188, 155, 115, 1)',
                        backgroundColor: 'rgba(188, 155, 115, 0.1)',
                        fill: true,
                        tension: 0.3
                    });
                }
                if (selectedType === 'Público' || selectedType === 'Todos') {
                     datasets.push({
                        label: 'Públicos',
                        data: years.map(year => sumTotal(datosPublicos, year)),
                        borderColor: 'rgba(113, 120, 91, 1)',
                        backgroundColor: 'rgba(113, 120, 91, 0.1)',
                        fill: true,
                        tension: 0.3
                    });
                }
            }

            charts.evolucion.data.datasets = datasets;
            document.getElementById('evolucion-title').textContent = selectedTramite === 'Todos' ? 'Evolución Anual de Trámites' : `Evolución de: ${selectedTramite}`;
            charts.evolucion.update();
        }

        function updateTopTramitesChart() {
            const topTramitesCard = document.getElementById('top-tramites-card');
            if (selectedTramite !== 'Todos') {
                topTramitesCard.style.display = 'none';
                return;
            }
            topTramitesCard.style.display = 'block';

            let dataset = getFilteredData();
            
            const sortedData = [...dataset]
                .sort((a, b) => (b[selectedYear] || 0) - (a[selectedYear] || 0))
                .slice(0, 5);

            charts.topTramites.data.labels = sortedData.map(d => d.tramite);
            charts.topTramites.data.datasets[0].data = sortedData.map(d => d[selectedYear]);
            charts.topTramites.data.datasets[0].label = `Trámites en ${selectedYear}`;
            charts.topTramites.data.datasets[0].backgroundColor = selectedType === 'Público' ? 'rgba(113, 120, 91, 0.7)' : 'rgba(188, 155, 115, 0.7)';
            document.getElementById('top-tramites-title').textContent = `Top 5 Trámites ${selectedType === 'Todos' ? '' : selectedType + 's'}`;
            charts.topTramites.update();
        }

        function updateDataTable() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const tableBody = document.getElementById('full-data-table');
            
            let dataset = getFilteredData();

            const filteredData = dataset.filter(item => item.tramite.toLowerCase().includes(searchTerm));

            tableBody.innerHTML = '';
            filteredData.forEach(item => {
                const row = `
                    <tr>
                        <td class="px-6 py-4 whitespace-normal text-sm font-medium text-gray-900">${item.tramite}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">${(item['2021'] || 0).toLocaleString()}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">${(item['2022'] || 0).toLocaleString()}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">${(item['2023'] || 0).toLocaleString()}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">${(item['2024'] || 0).toLocaleString()}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        function populateTramiteFilter() {
            const filters = [document.getElementById('tramite-filter'), document.getElementById('tramite-filter-mobile')];
            filters.forEach(filter => {
                filter.innerHTML = '<option value="Todos">Todos los Trámites</option>';
                let dataset;
                if (selectedType === 'Particular') {
                    dataset = datosParticulares;
                } else if (selectedType === 'Público') {
                    dataset = datosPublicos;
                } else {
                    dataset = [...datosParticulares, ...datosPublicos];
                }
                const tramites = [...new Set(dataset.map(item => item.tramite))].sort();
                tramites.forEach(t => {
                    const option = document.createElement('option');
                    option.value = t;
                    option.textContent = t;
                    filter.appendChild(option);
                });
            });
        }

        function updateAll() {
            updateKPIs();
            updateEvolucionChart();
            updateTopTramitesChart();
            updateDataTable();
        }

        function initCharts() {
            const ctxEvolucion = document.getElementById('evolucionChart').getContext('2d');
            charts.evolucion = new Chart(ctxEvolucion, {
                type: 'line',
                data: { labels: ['2021', '2022', '2023', '2024'], datasets: [] },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'logarithmic',
                            title: {
                                display: true,
                                text: 'Cantidad de Trámites (Escala Logarítmica)'
                            }
                        }
                    }
                }
            });

            const ctxTopTramites = document.getElementById('topTramitesChart').getContext('2d');
            charts.topTramites = new Chart(ctxTopTramites, {
                type: 'bar',
                data: { labels: [], datasets: [{ data: [], borderWidth: 1 }] },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            populateTramiteFilter();
            updateAll();

            const yearFilters = [document.getElementById('year-filter'), document.getElementById('year-filter-mobile')];
            const typeFilters = [document.getElementById('type-filter'), document.getElementById('type-filter-mobile')];
            const tramiteFilters = [document.getElementById('tramite-filter'), document.getElementById('tramite-filter-mobile')];
            const allPrintButtons = [document.getElementById('print-button'), document.getElementById('print-button-mobile')];
            
            yearFilters.forEach(filter => {
                filter.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON') {
                        selectedYear = e.target.dataset.year;
                        yearFilters.forEach(f => {
                            f.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                            f.querySelector(`[data-year="${selectedYear}"]`).classList.add('active');
                        });
                        updateAll();
                    }
                });
            });

            typeFilters.forEach(filter => {
                filter.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON') {
                        selectedType = e.target.dataset.type;
                        typeFilters.forEach(f => {
                            f.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                            f.querySelector(`[data-type="${selectedType}"]`).classList.add('active');
                        });
                        selectedTramite = 'Todos';
                        populateTramiteFilter();
                        tramiteFilters.forEach(f => f.value = 'Todos');
                        updateAll();
                    }
                });
            });
            
            tramiteFilters.forEach(filter => {
                filter.addEventListener('change', (e) => {
                    selectedTramite = e.target.value;
                    tramiteFilters.forEach(f => f.value = selectedTramite);
                    updateAll();
                });
            });

            document.getElementById('search-input').addEventListener('keyup', updateDataTable);

            allPrintButtons.forEach(button => {
                button.addEventListener('click', () => window.print());
            });
        });

    </script>
</body>
</html>
